
# AI-Driven 3D Apartment Generation Tool 

This tool was developed to generate a 3d apartment based on room graph and text description of the furniture. The tool combined floorplans generated by HouseGAN and furniture layouts for from InstructScene. It uses high quality 3d models from the furniture dataset ‚Äù3D-FUTURE‚Äù.

## Table of Contents

- [Installation](#installation)
- [Configuration](#configuration)
- [Features](#features)
- [Usage](#usage)
- [Testing](#testing)
- [Examples](#examples)

---

## üîß Installation

### üìå Requirements
- Linux Ubuntu 22.04+ (Not tested on other OSs)
- Python 3.7+
- 70 Gigabytes free space


### A. ‚öôÔ∏è App Virtual Environment
- Create a virtual environment for the app and update the configs file with its path:
- Execute the following command within the virtual environment to install the required libs using the requirements file: 
```bash
python3 -m pip install -r requirements.txt
```




### B. üëÄ Blender
- Download blender and update the config constant with its path
```bash
cd blender
wget https://download.blender.org/release/Blender3.3/blender-3.3.1-linux-x64.tar.xz
tar -xvf blender-3.3.1-linux-x64.tar.xz
rm blender-3.3.1-linux-x64.tar.xz
```

- Important!!!! :the embeded python must have the following libs: numpy, trimesh, mathutils, bmesh, argparse, json, hashlib
- execute this in the python/bin/ folder inside blender folder:

```bash
python -m pip install --upgrade pip, numpy, trimesh, mathutils, bmesh, argparse, json, hashlib
```
- Give exec permisions for blender both in app (constants[\'blender_path\']) and instruct scene in (folder /blender)



### C. ü™ü InstructScene
- The 3D Apartment Generation Tool includes a modified version of InstructScene to be used in the generation process.
- Create another virtual environment for InstructScene and indide it do the following:

You may need to modify the specific version of `torch` in `InstructScene/settings/setup.sh` according to your CUDA version.
There are not restrictions on the `torch` version, feel free to use your preferred one.
```bash
bash InstructScene/settings/setup.sh
```

- Install graphviz in instruct scene environment : 
```bash
sudo apt install graphviz
```

- ensure to install pyav and opencv in the InstructScene environment:
```bash
pip install imageio[pyav]
pip install imageio[opencv]
```

- update the configs with the virtual environment path for InstructScene




## D. üì¶ Datasets (3D-FRONT + 3D-FUTURE)
- The datasets used in the tool are not included and must be downloaded.
Dataset used is based on [3D-FRONT](https://tianchi.aliyun.com/specials/promotion/alibaba-3d-scene-dataset) and [3D-FUTURE](https://tianchi.aliyun.com/specials/promotion/alibaba-3d-future).

- It is recommended to install preprocessed instruction-scene paired dataset used in the paper and rendered images for evaluation on [HuggingFace](https://huggingface.co/datasets/chenguolin/InstructScene_dataset).
```python
import os
from huggingface_hub import hf_hub_url
url = hf_hub_url(repo_id="chenguolin/InstructScene_dataset", filename="InstructScene.zip", repo_type="dataset")
os.system(f"wget {url} && unzip InstructScene.zip")
url = hf_hub_url(repo_id="chenguolin/InstructScene_dataset", filename="3D-FRONT.zip", repo_type="dataset")
os.system(f"wget {url} && unzip 3D-FRONT.zip")
```
- or execute the script 'InstructScene/dataset/download.py'
- The datasets are over 40 Gigabytes, downloading and extractions could take long time ‚è≥.

Please refer to [InstructScene/dataset/README.md](./InstructScene/dataset/README.md) for more details.





## F. üìé Absolute Paths
- InstructScene scripts contain paths that must be changed manually to refere to the currect path on the currecnt computer.
- Change paths in .yaml files in 'InstructScene/configs' folder to point to the current absolute path of instruct scene folder
- Also change paths in
  - InstructScene/dataset/get_3dfuture_pkl.py : lines (14,15,16)
  - InstructScene/dataset/get_3dfuture_pkl.py : lines (34,39)
  - InstructScene/src/data/threed_front_scene.py : lines (252, 253 ,254)
  - InstructScene/src/utils/visualize.py : lines (426, 427)









## ‚õì Configuration

- constants['blender_path'] = "/home/fpc/blender-4.1.1-linux-x64/blender"
- constants['app_path'] = "/home/fpc/Uni/RL/repos/apartment_generator/"
- constants['instruct_scene_path'] = '/home/fpc/Uni/RL/repos/instruct_scene_2/InstructScene'
- constants['instruct_scene_conda_env_path'] = '/home/fpc/miniconda3/envs/instructScene2/bin/python'
- floorplan_samples = 10
- door_collision_depth = 3.5 

## Features

- **Generates 3D Apartments**: based on user input.


## üïπ Usage
- Run the application.py to start the server ('start server' should be seen in console output)
- Open any browser and go to '[http://127.0.0.1:5000/](http://127.0.0.1:5000/)'

#### Generate 2D Floorplan
- Edit the graph by adding/removing rooms and doors.
- Click `Generate 2D Plan`

#### Generate 3D Apartment
- Type a text descrring the furniture in each room.
- Edit the general apartment paramters 
- Click `Generate 3D`





## üìä Testing
### Generate Graphs
- evaluations_show2.py  : Displays the results of apartments usability evaluations in boxplot graphs.
- evaluations_show3.py  : Displays infos about of apartments like distribution of apartments and room sizes, total number of rooms per type, in graphs.
- evaluations_show4.py  : Displays the apartment generation times in boxplot graphs.


### Regenerate Apartments
##### to regenerate 3d front .glb files from 3d front dataset 
- 1. Use json2obj.py from 3d front toolbox to convert each json to a folder containing rooms and .obj files
```bash
 python scripts/json2obj.py --future_path=/home/fpc/Uni/RL/repos/instruct_scene_2/InstructScene/dataset/3D-FRONT/3D-FUTURE-model --json_path=/home/fpc/Uni/RL/repos/instruct_scene_2/InstructScene/dataset/3D-FRONT/3D-FRONT/ --texture_path=/home/fpc/Uni/RL/repos/instruct_scene_2/InstructScene/dataset/3D-FRONT/3D-FRONT-texture --save_path=./out
```
- 2. Run 'batch_3d_front_convert.py' after with actual folder paths to convert previously generated folders to .glb files

##### to generate many apartments without using the GUI, use the './evaluation/generate_tool_input.py'

### Rerun Evaluations
Use the folowing scripts:

- batch_evaluate_guidlines.py
- batch_evaluate_room.py
- batch_evaluate.py




## üì∏ Examples



---
